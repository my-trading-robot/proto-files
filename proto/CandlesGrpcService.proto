
syntax = "proto3";
import "google/protobuf/empty.proto";
package candles_grpc;

enum CandleGrpcType{
    MINUTE = 0;
    HOUR = 1;
    DAY = 2;
    MONTH = 3;
    MINUTE5 = 4;
}

message CandleGrpcModel{
    int64 date_key = 1;
    double open = 2;
    double close = 3;
    double high = 4;
    double low = 5;
    double volume = 6;
}

message GetCandlesHistoryGrpcRequest {
    string instrument_id = 1;
    uint64 from_key = 2;
    uint64 to_key = 3;
    CandleGrpcType candle_type = 4;
    bool is_bid = 5;
    optional uint64 limit = 6;
}

message GetMyAmountGrpcRequest {
    string instrument_id = 1;
    uint64 highest_key = 2;
    uint64 max_amount = 3;
    CandleGrpcType candle_type = 4;
    bool is_bid = 5;
}

message GetAtrFilterCountGrpcRequest {
    string instrument_id = 1;
    CandleGrpcType candle_type = 2;
}

message GetAtrFilterCountGrpcResponse {
    uint64 ignored_above_count = 1;
    uint64 ignore_below_count = 2;
    uint64 unfiltered_count = 3;
}


message UpdateCandlesGrpcRequest {
    string instrument_id = 1;
    int64 date_from = 2;
    int64 total_days = 3;
}

service CandlesGrpcService {
    rpc GetCandlesByInstrument(GetCandlesHistoryGrpcRequest) returns (stream CandleGrpcModel);    
    rpc GetByAmount(GetMyAmountGrpcRequest) returns (stream CandleGrpcModel);
    rpc GetAtrFilterCount(GetAtrFilterCountGrpcRequest) returns (GetAtrFilterCountGrpcResponse);

    rpc LoadCandlesFromSource(UpdateCandlesGrpcRequest) returns (google.protobuf.Empty);

    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}
